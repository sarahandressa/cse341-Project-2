# swagger/paths.yaml

# =======================================================================================
#                                 AUTHENTICATION (Auth)
# =======================================================================================
/login:
  post:
    summary: Authenticate a user and return a JWT token
    tags:
      - Auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - email
              - password
            properties:
              email:
                type: string
                format: email
              password:
                type: string
                format: password
    responses:
      '200':
        description: Successful login, returns JWT token and user ID
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                token:
                  type: string
                userId:
                  type: string
      '401':
        description: Invalid credentials

/register:
  post:
    summary: Register a new user
    tags:
      - Auth
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - email
              - password
              - username
            properties:
              email:
                type: string
                format: email
              password:
                type: string
                format: password
              username:
                type: string
              displayName:
                type: string
                description: Optional. The user's public display name.
              isAdmin:
                type: boolean
                description: Optional. Set to true if the user should have administrative rights. Defaults to false.
    responses:
      '201':
        description: User registered successfully
      '400':
        description: User already exists

# =======================================================================================
#                                     BOOKS
# =======================================================================================
/books:
  get:
    summary: Retrieve a list of all books
    tags:
      - Books
    responses:
      '200':
        description: A list of books
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Book'
  post:
    summary: Create a new book (requires login)
    tags:
      - Books
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Book'
    responses:
      '201':
        description: Book created successfully
      '401':
        description: Unauthorized

/books/{id}:
  get:
    summary: Get a book by ID
    tags:
      - Books
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
        description: MongoDB ObjectId of the book
    responses:
      '200':
        description: The requested book
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Book'
      '404':
        description: Book not found
  put:
    summary: Update a book by ID (requires login)
    tags:
      - Books
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the book
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Book'
    responses:
      '200':
        description: Book updated successfully
      '401':
        description: Unauthorized
      '404':
        description: Book not found
  delete:
    summary: Delete a book by ID (requires login)
    tags:
      - Books
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the book
    responses:
      '200':
        description: Book deleted successfully
      '401':
        description: Unauthorized
      '404':
        description: Book not found

# =======================================================================================
#                                     CLUBS
# =======================================================================================
/clubs:
  get:
    summary: Retrieve a list of all public and user-joined clubs
    tags:
      - Clubs
    responses:
      '200':
        description: A list of clubs
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Club'
  post:
    summary: Create a new club (requires login)
    tags:
      - Clubs
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Club'
    responses:
      '201':
        description: Club created successfully
      '401':
        description: Unauthorized

/clubs/{id}:
  get:
    summary: Get a club by ID
    tags:
      - Clubs
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the club
    responses:
      '200':
        description: The requested club
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Club'
      '404':
        description: Club not found
  put:
    summary: Update a club by ID (requires login)
    tags:
      - Clubs
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the club
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Club'
    responses:
      '200':
        description: Club updated successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the admin)
      '404':
        description: Club not found
  delete:
    summary: Delete a club by ID (requires login)
    tags:
      - Clubs
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the club
    responses:
      '200':
        description: Club deleted successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the admin)
      '404':
        description: Club not found

# =======================================================================================
#                                     MEETINGS
# =======================================================================================
/meetings/club/{clubId}:
  get:
    summary: Get all meetings for a specific club
    tags:
      - Meetings
    parameters:
      - in: path
        name: clubId
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the club
    responses:
      '200':
        description: List of meetings for the club
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Meeting'

/meetings:
  post:
    summary: Create a new meeting (requires login)
    tags:
      - Meetings
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Meeting'
    responses:
      '201':
        description: Meeting created successfully
      '401':
        description: Unauthorized

/meetings/{id}:
  get:
    summary: Get a single meeting by ID
    tags:
      - Meetings
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the meeting
    responses:
      '200':
        description: The requested meeting
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Meeting'
      '404':
        description: Meeting not found
  put:
    summary: Update a meeting by ID (requires login)
    tags:
      - Meetings
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the meeting
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Meeting'
    responses:
      '200':
        description: Meeting updated successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the host)
      '404':
        description: Meeting not found
  delete:
    summary: Delete a meeting by ID (requires login)
    tags:
      - Meetings
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the meeting
    responses:
      '200':
        description: Meeting deleted successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the host)
      '404':
        description: Meeting not found

/meetings/{id}/attend:
  post:
    summary: Adds the authenticated user as an attendee to a meeting
    tags:
      - Meetings
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the meeting
    responses:
      '200':
        description: Attendance status updated successfully
      '401':
        description: Unauthorized
  delete:
    summary: Removes the authenticated user from the meeting attendees list
    tags:
      - Meetings
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the meeting
    responses:
      '200':
        description: Attendance status removed successfully
      '401':
        description: Unauthorized

# =======================================================================================
#                                      POSTS
# =======================================================================================
/posts/club/{clubId}:
  get:
    summary: Retrieve a list of all posts for a specific club
    tags:
      - Posts
    parameters:
      - in: path
        name: clubId
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the club
    responses:
      '200':
        description: A list of posts for the club
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/Post'

/posts:
  post:
    summary: Create a new post (requires login)
    tags:
      - Posts
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Post'
    responses:
      '201':
        description: Post created successfully
      '401':
        description: Unauthorized

/posts/{id}:
  get:
    summary: Get a post by ID
    tags:
      - Posts
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the post
    responses:
      '200':
        description: The requested post
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Post'
      '404':
        description: Post not found
  put:
    summary: Update a post by ID (requires login)
    tags:
      - Posts
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the post
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Post'
    responses:
      '200':
        description: Post updated successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the author)
      '404':
        description: Post not found
  delete:
    summary: Delete a post by ID (requires login)
    tags:
      - Posts
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the post
    responses:
      '200':
        description: Post deleted successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the author)
      '404':
        description: Post not found

# =======================================================================================
#                                READING PROGRESS
# =======================================================================================
/progress/club/{clubId}:
  get:
    summary: Get all reading progress entries for a specific club
    tags:
      - Reading Progress
    parameters:
      - in: path
        name: clubId
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the club
    responses:
      '200':
        description: List of progress entries for the club
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/ReadingProgress'

/progress/user/{userId}/book/{bookId}/club/{clubId}:
  get:
    summary: Get a specific user's progress for a book within a club
    tags:
      - Reading Progress
    parameters:
      - in: path
        name: userId
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the User
      - in: path
        name: bookId
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the Book
      - in: path
        name: clubId
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the Club
    responses:
      '200':
        description: Returns the progress object or null if not found
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReadingProgress'
      '400':
        description: Invalid ID format

/progress:
  post:
    summary: Create or Update a user's reading progress (Upsert - requires login)
    description: Creates a new entry or updates the existing progress for the authenticated user based on the unique combination of book and club IDs.
    tags:
      - Reading Progress
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - book
              - club
              - percentage
            properties:
              book:
                type: string
                description: ID of the Book
              club:
                type: string
                description: ID of the Club
              percentage:
                type: number
                format: float
                description: Reading completion percentage (0-100)
              currentPage:
                type: integer
                description: Last page number read
    responses:
      '201':
        description: Progress recorded/updated successfully
      '401':
        description: Unauthorized

/progress/{id}:
  get:
    summary: Get a single reading progress entry by ID
    tags:
      - Reading Progress
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the ReadingProgress entry
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReadingProgress'
      '404':
        description: Not Found
  delete:
    summary: Delete a reading progress entry by ID (requires login)
    tags:
      - Reading Progress
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema:
          type: string
          description: MongoDB ObjectId of the ReadingProgress entry
    responses:
      '200':
        description: Progress deleted successfully
      '401':
        description: Unauthorized
      '403':
        description: Forbidden (User is not the owner)
      '404':
        description: Not Found